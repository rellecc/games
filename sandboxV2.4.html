<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SandBox</title>
<style>
:root { --sidebar-w:250px; --grid-size:50px; }
html,body{height:100%;margin:0;font-family:Segoe UI,sans-serif;}
body{margin:0;overflow:hidden;}
.screen{position:absolute;top:0;left:0;width:100%;height:100%;background:#222;color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;}
.screen h1,.screen h2{margin:12px;font-size:36px;}
.screenBtn{margin:12px;padding:12px 24px;background:#444;color:#fff;font-size:18px;border:none;border-radius:8px;cursor:pointer;}
#gameContainer{display:flex;height:100%;display:none;}
#sidebar{width:var(--sidebar-w);background:#2f2f2f;color:#fff;padding:12px;box-sizing:border-box;overflow:auto;}
h2{margin:6px 0 12px 0;font-size:18px;text-align:center;}
.btn{display:block;width:90%;margin:8px auto;padding:9px;text-align:center;background:#464646;color:#fff;cursor:pointer;border-radius:6px;border:2px solid rgba(255,255,255,0.06);font-weight:600;}
.btn.selected{outline:3px solid rgba(255,255,255,0.08);}
#colorPicker,#bgColorPicker,#secondaryColorPicker{display:block;width:90%;margin:6px auto;height:30px;border:0;}
#sandbox{position:relative;flex:1;background:#bfbfbf;cursor:crosshair;overflow:hidden;}
#gridCanvas{position:absolute;left:0;top:0;pointer-events:none;z-index:0;}
.block{position:absolute;width:var(--grid-size);height:var(--grid-size);box-sizing:border-box;border:1px solid rgba(0,0,0,0.5);transform-origin:center;}
.hover-delete::after{
  content:"X";position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
  font-size:30px;font-weight:bold;
  background:rgba(255,0,0,0.7);
}
.hover-rotate::after{
  content:"⟳";position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
  font-size:32px;font-weight:bold;
  background:rgba(0,140,255,0.7);
}
</style>
</head>
<body>

<div id="titleScreen" class="screen">
<h1>SandBox</h1>
<p>Made by Corgii</p>
<button class="screenBtn" onclick="startGame()">Play</button>
</div>

<div id="gameContainer">
<div id="sidebar">
<h2>LEGO Sandbox</h2>
<div class="btn" id="b-square" onclick="selectBlock('square')">Square</div>
<div class="btn" id="b-square-op" onclick="selectBlock('square-opacity')">Square 40%</div>
<div class="btn" id="b-tri-left" onclick="selectBlock('triangle-left')">Left Triangle</div>
<div class="btn" id="b-tri-right" onclick="selectBlock('triangle-right')">Right Triangle</div>
<div class="btn" id="b-stairs-left" onclick="selectBlock('stairs-left')">Stairs Left</div>
<div class="btn" id="b-stairs-right" onclick="selectBlock('stairs-right')">Stairs Right</div>
<div class="btn" id="b-bed-left" onclick="selectBlock('bed-left')">Bed Left</div>
<div class="btn" id="b-bed-right" onclick="selectBlock('bed-right')">Bed Right</div>
<div class="btn" id="b-couch" onclick="selectBlock('couch')">Couch</div>
<div class="btn" id="b-desk" onclick="selectBlock('desk')">Desk</div>
<div class="btn" id="b-ladder" onclick="selectBlock('ladder')">Ladder</div>
<div class="btn" id="b-light" onclick="selectBlock('light')">Light</div>
<div class="btn" id="b-mailbox-left" onclick="selectBlock('mailbox-left')">Mailbox Left</div>
<div class="btn" id="b-mailbox-right" onclick="selectBlock('mailbox-right')">Mailbox Right</div>
<div class="btn" id="b-flower" onclick="selectBlock('flower')">Flower</div>
<div class="btn" id="b-rotate" onclick="selectBlock('rotate')">Rotate</div>
<div class="btn" id="b-delete" onclick="selectBlock('delete')">Delete</div>
<div class="btn" id="b-clear" onclick="clearSandbox()">Clear</div>

<h3>Primary Color</h3>
<input type="color" id="colorPicker" value="#ff3b3b">
<h3>Secondary Color</h3>
<input type="color" id="secondaryColorPicker" value="#ffff99">
<h3>Background</h3>
<input type="color" id="bgColorPicker" value="#bfbfbf">
</div>

<div id="sandbox">
<canvas id="gridCanvas"></canvas>
</div>
</div>

<script>
const sandbox=document.getElementById('sandbox');
const gridCanvas=document.getElementById('gridCanvas');
const gctx=gridCanvas.getContext('2d');
const gridSize=50;
let currentTool='square';
let lastHover=null;
let isMouseDown=false;

function startGame(){
  document.getElementById('titleScreen').style.display='none';
  document.getElementById('gameContainer').style.display='flex';
  resizeGrid();
}

bgColorPicker.oninput=()=>sandbox.style.background=bgColorPicker.value;
window.addEventListener('resize',resizeGrid);
function resizeGrid(){
  gridCanvas.width=sandbox.clientWidth;
  gridCanvas.height=sandbox.clientHeight;
  drawGrid();
}
function drawGrid(){
  gctx.clearRect(0,0,gridCanvas.width,gridCanvas.height);
  gctx.strokeStyle='rgba(0,0,0,0.3)';
  for(let x=0;x<gridCanvas.width;x+=gridSize){
    gctx.beginPath();gctx.moveTo(x+.5,0);gctx.lineTo(x+.5,gridCanvas.height);gctx.stroke();
  }
  for(let y=0;y<gridCanvas.height;y+=gridSize){
    gctx.beginPath();gctx.moveTo(0,y+.5);gctx.lineTo(gridCanvas.width,y+.5);gctx.stroke();
  }
}
function selectBlock(tool){
  currentTool=tool;
  document.querySelectorAll('.btn').forEach(b=>b.classList.remove('selected'));
  const b=document.getElementById('b-'+tool.replace('_','-'));
  if(b)b.classList.add('selected');
}
selectBlock('square');

function clearSandbox(){ document.querySelectorAll('.block').forEach(b=>b.remove()); }
function snap(n){return Math.floor(n/gridSize)*gridSize;}
function getTop(x,y){ return document.elementsFromPoint(x,y).find(e=>e.classList?.contains('block')&&e.parentElement===sandbox); }

function handleAction(e){
  const rect=sandbox.getBoundingClientRect();
  const x=snap(e.clientX-rect.left);
  const y=snap(e.clientY-rect.top);

  const color=colorPicker.value;
  const secondaryColor=secondaryColorPicker.value;

  if(currentTool==='delete'){
    const b=getTop(e.clientX,e.clientY);
    if(b) b.remove();
    return;
  }
  if(currentTool==='rotate'){
    const b=getTop(e.clientX,e.clientY);
    if(!b) return;
    const r=(parseInt(b.dataset.rot||0)+90)%360;
    b.dataset.rot=r;
    b.style.transform=`rotate(${r}deg)`;
    return;
  }

  // Prevent duplicates for square-opacity
  if(currentTool==='square-opacity'){
    if([...sandbox.children].some(b=>parseInt(b.style.left)==x && parseInt(b.style.top)==y && b.dataset.base)) return;
  }else{
    if([...sandbox.children].some(b=>parseInt(b.style.left)==x && parseInt(b.style.top)==y && b.classList.contains('block') && !b.dataset.base)) return;
  }

  const block=document.createElement('div');
  block.className='block';
  block.style.left=x+'px';
  block.style.top=y+'px';
  block.dataset.rot=0;

  switch(currentTool){
    case 'square': block.style.background=color; block.style.zIndex=2; break;
    case 'square-opacity': block.style.background=color; block.style.opacity=0.4; block.dataset.base="true"; block.style.zIndex=1; break;
    case 'triangle-left': block.style.background=color; block.style.clipPath='polygon(0 0,0 100%,100% 100%)'; block.style.zIndex=2; break;
    case 'triangle-right': block.style.background=color; block.style.clipPath='polygon(0 0,0 100%,100% 100%)'; block.style.transform='scaleX(-1)'; block.style.zIndex=2; break;
    case 'stairs-left': block.style.background=color; block.style.clipPath='polygon(0 0,33% 0,33% 33%,66% 33%,66% 66%,100% 66%,100% 100%,0 100%)'; block.style.zIndex=2; break;
    case 'stairs-right': block.style.background=color; block.style.clipPath='polygon(0 100%,0 66%,33% 66%,33% 33%,66% 33%,66% 0,100% 0,100% 100%)'; block.style.zIndex=2; break;
    case 'bed-left': block.style.width='100px'; block.style.height='50px'; block.style.background=`linear-gradient(to right, ${color} 50%, grey 50%)`; block.style.zIndex=2; break;
    case 'bed-right': block.style.width='100px'; block.style.height='50px'; block.style.background=`linear-gradient(to right, grey 50%, ${color} 50%)`; block.style.zIndex=2; break;
    case 'couch': block.style.width='100px'; block.style.height='50px'; block.style.background=color; block.style.clipPath='polygon(0 100%,0 30%,10% 10%,90% 10%,100% 30%,100% 100%)'; block.style.zIndex=2; break;
    case 'desk': block.style.background=color; block.style.clipPath='polygon(0 100%,0 20%,10% 20%,10% 0,90% 0,90% 20%,100% 20%,100% 100%)'; block.style.zIndex=2; break;
    case 'ladder':
      block.style.background='none';
      block.innerHTML=`
        <div style="position:absolute;top:0;left:10%;width:4px;height:50px;background:${color};"></div>
        <div style="position:absolute;top:0;right:10%;width:4px;height:50px;background:${color};"></div>
        <div style="position:absolute;top:12px;left:10%;width:80%;height:4px;background:${color};"></div>
        <div style="position:absolute;top:34px;left:10%;width:80%;height:4px;background:${color};"></div>`;
      break;
    case 'light':
      block.style.background='none';
      block.style.zIndex=3;
      block.innerHTML=`
        <div style="position:absolute;top:0;left:50%;width:4px;height:15px;background:${color};transform:translateX(-50%)"></div>
        <div style="position:absolute;top:15px;left:50%;width:20px;height:20px;background:${secondaryColor};border-radius:50%;transform:translateX(-50%);box-shadow:0 0 20px 10px ${secondaryColor}"></div>`;
      break;
    case 'mailbox-left':
      block.style.background='none';
      block.style.width=gridSize+'px';
      block.style.height=gridSize*2+'px';
      block.style.zIndex=2;
      block.innerHTML=`
        <div style="position:absolute;top:0;left:50%;width:4px;height:100%;background:${color};transform:translateX(-50%)"></div>
        <div style="position:absolute;top:0;left:50%;width:40px;height:25px;background:${secondaryColor};clip-path:polygon(0 0,90% 0,100% 50%,90% 100%,0 100%);transform:translateX(-50%)"></div>`;
      break;
    case 'mailbox-right':
      block.style.background='none';
      block.style.width=gridSize+'px';
      block.style.height=gridSize*2+'px';
      block.style.zIndex=2;
      block.innerHTML=`
        <div style="position:absolute;top:0;left:50%;width:4px;height:100%;background:${color};transform:translateX(-50%)"></div>
        <div style="position:absolute;top:0;left:50%;width:40px;height:25px;background:${secondaryColor};clip-path:polygon(0 50%,10% 0,100% 0,100% 100%,10% 100%);transform:translateX(-50%)"></div>`;
      break;
    case 'flower':
      block.style.width=gridSize/2+'px';
      block.style.height=gridSize+'px';
      block.style.left=(x+gridSize/4)+'px';
      block.style.top=y+'px';
      block.style.background=`linear-gradient(to top, ${color} 40%, ${secondaryColor} 100%)`;
      block.style.clipPath='ellipse(30% 20% at 50% 85%), polygon(45% 85%,55% 85%,50% 100%)';
      block.style.zIndex=3;
      break;
  }

  sandbox.appendChild(block);
}

// Brush behavior
sandbox.addEventListener('mousedown',e=>{isMouseDown=true; handleAction(e);});
sandbox.addEventListener('mouseup',()=>{isMouseDown=false;});
sandbox.addEventListener('mouseleave',()=>{isMouseDown=false; if(lastHover){lastHover.classList.remove('hover-delete','hover-rotate');lastHover=null;}});
sandbox.addEventListener('mousemove',e=>{if(isMouseDown) handleAction(e);});

</script>
</body>
</html>

